<form id="budget-form" name="budget-form" method="POST">
  {{ form.hidden_tag() }}
  <div class="card card-body d-flex">
    <div class="form-inline">
      <label class="fs-rem-1-8" for="budget_name">Budget name:&nbsp;</label>
      <input class="form-control fs-rem-1-6" id="budget_name" name="budget_name" placeholder="My First Budget" maxlength="30" value="{{ budget.name if budget.name else '' }}">
      <div class="dropdown dropleft ml-auto">
        <i class="fas fa-2x fa-ellipsis-v"
            type="button"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false">
        </i>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <button class="dropdown-item">Select Budget</button>
          <button
            class="dropdown-item"
            ic-confirm="Unsaved budget data will be deleted. Continue?"
            ic-get-from="{{ url_for('finance.new_budget') }}"
            ic-target='#budget-inner'>New Budget</button>
          <button class="dropdown-item">Share</button>
        </div>
      </div>
    </div>
    <div class="form-inline">
        <label class="fs-rem-1-8" for="budget_view_period">View:&nbsp;</label>
        <select id="budget_view_period" name="budget_view_period" class="form-control">
          {% set period = budget.period %}
          {% include "finance/form_timeperiod_selector.html" %}
        </select>
    </div>
  </div>

  <div class="card">
    {% for category in budget.budget %}
    <div class="budget-category">
      <div data-toggle="collapse" data-target="#{{ id_safe(category) }}-Collapse" aria-expanded="false" aria-controls="{{ id_safe(category) }}-Collapse" class="cursor-pointer card-header fs-rem-1-8">
        <span class="category-label">{{ category }}</span>
        <span class="float-right category-total"></span>
      </div>
      <div id="{{ id_safe(category) }}-Collapse" class="collapse fs-rem-1-4">
        {% for item in budget.budget[category] %}
        <div id="{{ id_safe(category) }}-{{ loop.index }}" class="row budget-item">
          <div class="col-sm">
            <label class="budget-item-label" for="{{ id_safe(category) }}-{{ loop.index }}-value">{{ item }}</label>
          </div>
          <div class="col">
            <input class="form-control input-val" inputmode="decimal" type="number" id="{{ id_safe(category) }}-{{ loop.index }}-value" value="{{ budget.budget[category][item]['value'] if budget.budget[category][item]['value'] else '' }}">
          </div>
          <div class="col">
            <select class="form-control input-timeperiod" name="{{ id_safe(category) }}-{{ loop.index }}-select" id="{{ id_safe(category) }}-{{ loop.index }}-select">
            {% set period = budget.budget[category][item]["period"] %}
            {% include "finance/form_timeperiod_selector.html" %}
            </select>
          </div>
          <div class="col text-right">
            <span class="item-total" id="{{ id_safe(category) }}-{{ loop.index }}-total">$0</span>
            <span class="item-pos" hidden aria-hidden="true">{{ budget.budget[category][item].get("pos", "False") }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="card">
    <div id="budget-summary">
      <div data-toggle="collapse" data-target="#budgetSummary-Collapse" aria-expanded="false" aria-controls="budgetSummary-Collapse" class="cursor-pointer card-header fs-rem-1-8">
        <span class="summary-label">Summary</span>
        <span class="float-right summary-total"></span>
      </div>
      <div id="budgetSummary-Collapse" class="collapse fs-rem-1-4">
        <h2>GRAPHS GO HERE</h2>
      </div>
    </div>
  </div>
</form>

{% if refresh_js %}
<script>
  budgetSummary = new BudgetSummary($(domStrings.budgetSummary))
  budgetSummary.createBudgetCategories()
  $(domStrings.budgetName).change(() => {
    budgetUpdatedTime = new Date()
  })
  $(domStrings.viewTimePeriod).change(() => {
    budgetUpdatedTime = new Date()
  })
  setInterval(stashBudget, 15000)
</script>
{% endif %}
